/**

* \file      main.c

* \author    Tiyangou Quentin

* \version   <0.1>

* \date      <18-12-2020>

* \brief     <bataille navale vers 0.1>

*

* \details    <modification de la bataille navale>

*/

#include <stdio.h>

#include <windows.h>

#include <time.h>

#pragma execution_character_set("utf-8")

void emptyBuffer() {
    int c = 0;
    while (c != '\n' && c != EOF) {
        c = getchar();
    }
}


//variables
int selectionplayer, erreur;//setting variables

int coord2 = 0, end = 0;//variables
char coord1 = '0';

//fonctions

void shoot() {

    char tir[3]; //shoot value
    int verif = 0; //entry value verification
    int coord1; //ligne value
    int coord2; //row value
    int MaxTour, tour = 0, hit1=0, win, MaxGrille, grille[coord1][coord2];

    while (verif != 1) {
        printf("Choisir une case : ");
        scanf("%s", &tir);
        printf("%d\n", strlen(tir));

        if (tir[0] <= 106 && tir[0] >= 97) {
            tir[0] -= 32;
        }

        if (strlen(tir) == 3) {
            coord1 = 10 * (tir[1] - 49) + (tir[2] - 49) + 10;  //changes the player's value
        } else {
            coord1 = tir[1] - 49;
        }
        coord2 = tir[0] - 65;

        while (coord1 < 0 || coord1 > 9 || coord2 < 0 || coord2 > 9 || strlen(tir) > 3) { //value unknown
            printf("\nIl n'y a pas de case ici\n\n");
            printf("Choisir une case : ");
            scanf("%s", &tir);

            if (tir[0] <= 106 && tir[0] >= 97) {
                tir[0] -= 32;
            }

            if (strlen(tir) == 3) {
                coord1 = 10 * (tir[1] - 49) + (tir[2] - 49) + 10;
            } else {
                coord1 = tir[1] - 49;
            }
            coord2 = tir[0] - 65;
        }


        if (grille[coord1][coord2] < 10 && grille[coord1][coord2] > 0) {    //touché
            system("cls");
            printf("\nTouché");
            grille[coord1][coord2] = grille[coord1][coord2] + 10;
            verif = 1;
            if (MaxTour - tour == 1) {
                tour += 2;
            } else {
                tour += 1;
            }

        } else {//Plouf
            system("cls");
            printf("\nPlouf");
            grille[coord1][coord2] = 100;
            verif = 1;
            if (MaxTour - tour == 1) {
                tour += 2;
            } else {
                tour += 1;
            }
        }
    }

}

void endgame(int grille[10][10]) {
    int compteur = 0;
//victory condition
    for (int i = 0; i <= 9; ++i) {
        for (int j = 0; j <= 9; ++j) {
            if (grille[i][j] > 0 && grille[i][j] < 10) {
                compteur++;

            }
        }

    }
    if (compteur = 0) { printf("Bien Joué tu as Gagné"); }
    else { printf("\nMeh Loser\n"); }


}

void affichage(grille[10][10]) {


    system("cls");
    printf("      A  B  C  D  E  F  G  H  I  J  ");

    for (int i = 0; i <= 9; i++) {//numbers axis y

        printf("\n%5.d", i + 1);


        for (int l = 0; l <= 9; ++l) {//displays the grid
            if (grille[i][l] > 10) {
                //  printf(" 0 ");
                printf(" %d ", grille[i][l]);
            } else if (grille[i][l] <= 101) {
                // printf(" X ");
                printf(" %d ", grille[i][l]);
            }


        }

    }


}


//jeu
void play(int grille[10][10]) {



    affichage(grille);
    endgame(grille);
    printf("fin de la partie");

}

void initialisation() {
    int grille[10][10] = {{0, 4, 4, 4, 4, 0, 0, 0, 0, 0},//set the boats on grille

                          {0, 0, 0, 0, 0, 0, 0, 0, 0, 0},

                          {0, 0, 0, 0, 0, 0, 0, 0, 0, 0},

                          {0, 0, 0, 0, 0, 2, 2, 0, 0, 0},

                          {0, 0, 0, 0, 0, 0, 1, 0, 0, 0},

                          {0, 0, 3, 0, 0, 0, 0, 0, 0, 0},

                          {0, 0, 3, 0, 0, 0, 0, 0, 0, 0},

                          {0, 0, 3, 0, 0, 0, 0, 0, 0, 0},

                          {0, 0, 0, 0, 0, 0, 0, 0, 0, 0},

                          {0, 0, 0, 0, 0, 0, 0, 0, 0, 0}
    };//grille
    affichage(grille);
    play(grille);
 }

void main() {

    SetConsoleOutputCP(65001);//displays special characters
    setbuf(stdout, 0);


    printf("Bienvenu dans la bataille Navale!\n\n");
    do {

        printf("selectionner:\n\n");

        printf("1. Jouer\n");

        printf("2. Instruction\n");

        printf("3. Scores\n");

        printf("4. S'enrengistrer\n");

        printf("5. quitter\n");
        scanf("%d", &selectionplayer); //take player selection
        system("cls");//clears console


        switch (selectionplayer) {//menu

            case 1: {//jouer
                initialisation();
                emptyBuffer();
                printf("continuer de jouer?"
                       "oui=0/non=1");

                scanf("%d", &end);
                break;

                case 2://instructions
                    printf("\nentrer une coordonnée comme suit: <lettre minuscule> entrée <numéro> pour tirer."
                           "\nle joueur gagne quand les 4 bateaux sont coulés en mois de 10 essais");
                printf("\nquitter=1 / retourner au menu =0");
                emptyBuffer();
                scanf("&d", &end);

                break;

                case 3:
                    printf("tableau des scores(in progress)");//affiche le tableau des scores

                break;

                case 4:
                    printf("identification(in progress)");//permet au joueur de s'identifier

                break;

                case 5:
                    printf("fermer (in progress)");//ferme le programme
                printf("Voulez-vous quitter?\n"
                       "oui =1 / non =0");
                emptyBuffer();
                scanf("&d", &end);
                break;

                default:

                    printf("Erreur! veuillez reessayer!\n");

                erreur = 1;//if value false back to player selection
                break;

            }


        }

    } while (end = 0);
}
