/**

* \file      main.c

* \author    Tiyangou Quentin

* \version   <0.1>

* \date      <20-01-2021>

* \brief     <bataille navale vers 1.0>

*

* \details    <modification de la bataille navale>

*/

#include <stdio.h>
#include <time.h>
#include <windows.h>


#pragma execution_character_set("utf-8")

void emptyBuffer() {
    int c = 0;
    while (c != '\n' && c != EOF) {
        c = getchar();
    }
}


//variables
int selectionplayer, erreur, playername;//setting variables

int choixlettre = '0', end = 0;//variables


//fonctions
int letter() {
    printf("\ninsérer des coordonnées:");
    char choixlettre = '0';
    scanf("%c", &choixlettre);//recieve the coordinates
    switch (choixlettre) {//convert character to number
        case 'a':

            choixlettre = 1;

            break;

        case 'b':

            choixlettre = 2;

            break;

        case 'c':

            choixlettre = 3;

            break;

        case 'd':

            choixlettre = 4;

            break;

        case 'e':

            choixlettre = 5;

            break;

        case 'f':

            choixlettre = 6;

            break;

        case 'g':

            choixlettre = 7;

            break;

        case 'h':

            choixlettre = 8;

            break;

        case 'i':

            choixlettre = 9;

            break;

        case 'j':

            choixlettre = 10;

            break;

    }

    void play();
}

void endgame(int grille[10][10]) {
    int compteur = 0;
//victory condition
    for (int i = 0; i <= 9; ++i) {
        for (int j = 0; j <= 9; ++j) {
            if (grille[i][j] > 0 && grille[i][j] < 10) {
                compteur++;

            }
        }

    }
    if (compteur <= 20) { printf("Bien Joué tu as Gagné"); }
    else { printf("Meh Loser"); }


}
//grid display
void affichage(int grille[10][10]) {


    system("cls");
    printf("      A  B  C  D  E  F  G  H  I  J  ");

    for (int i = 0; i <= 9; i++) {//numbers axis y

        printf("\n%5.d", i + 1);


        for (int l = 0; l <= 9; ++l) {//displays the grid
            if (grille[i][l] < 10) {
                printf(" 0 ");
            } else if (grille[i][l] >= 101) {
                printf(" X ");
            }

        }

    }

}


//jeu
void play(int grille[10][10]) {
    int compteur = 0;
    do {
        int Choixchiffre = 0;
        int Choixlettre = 0;
        system("cls");
        affichage(grille);
        printf("\n");
        printf("\n");

        Choixlettre = letter();

        printf("\nEntrez un chiffre: ");
        scanf("%d", &Choixchiffre); //gets the player's coordinate
        Choixchiffre = Choixchiffre - 1;

        if (grille[Choixlettre][Choixchiffre] > 1 &&
            grille[Choixlettre][Choixchiffre] < 100) { //add value to the selected coordinate
            grille[Choixlettre][Choixchiffre] = 0;
        }
        if (grille[Choixlettre][Choixchiffre] == 1 ) {
            grille[Choixlettre][Choixchiffre] = 100;
        }
        compteur++;
    } while (compteur >= 20);




    endgame(grille);
    printf("\nfin de la partie");
}


void initialisation() {
    int grille[10][10] = {{0, 1, 1, 1, 1, 0, 0, 0, 0, 0},//set the boats on grille

                          {0, 0, 0, 0, 0, 0, 0, 0, 0, 0},

                          {0, 0, 0, 0, 0, 0, 0, 0, 0, 0},

                          {0, 0, 0, 0, 0, 1, 1, 0, 0, 0},

                          {0, 0, 0, 0, 0, 0, 0, 0, 0, 0},

                          {0, 0, 1, 0, 0, 0, 0, 0, 0, 0},

                          {0, 0, 1, 0, 0, 0, 0, 0, 0, 0},

                          {0, 0, 1, 0, 0, 0, 0, 0, 0, 0},

                          {0, 0, 0, 0, 0, 0, 0, 0, 0, 0},

                          {0, 0, 0, 0, 0, 0, 0, 0, 0, 0}
    };//grille
    affichage(grille);
    play(grille);
}

void main() {

    SetConsoleOutputCP(65001);//displays special characters
    setbuf(stdout, 0);

    printf("Bienvenu dans la bataille Navale!\n\n");
    do {

        printf("selectionner:\n\n");

        printf("1. Jouer\n");

        printf("2. Instruction\n");

        printf("3. Scores\n");

        printf("4. S'enrengistrer\n");

        printf("5. quitter\n");
        scanf("%d", &selectionplayer); //take player selection
        system("cls");//clears console

        switch (selectionplayer) {//menu

            case 1: {//jouer
                initialisation();
                emptyBuffer();
                printf("\ncontinuer de jouer?"
                       "\noui=0/non=1");

                scanf("%d", &end);
                break;

                case 2://instructions
                    printf("\nentrer une coordonnée comme suit: <lettre minuscule> enter <numéro> pour tirer."
                           "\nle joueur gagne quand les 4 bateaux sont coulés");
                printf("\nretourner au menu =0\n"
                       "commencer une partie=1\n"
                       "quitter =5\n");
                emptyBuffer();
                scanf("&d", &end);

                break;

                case 3:
                    printf("\nVoici le Tableau des score!\n\n");

                FILE *fp;
                char str[MAXCHAR];
                char *filename = "c:\\users\\Quentin.TIYANGOU\\BNavale\\scores\\test.txt";

                fp = fopen(filename, "r");
                if (fp == NULL) {
                    printf("Could not open file %s", filename);
                }
                while (fgets(str, MAXCHAR, fp) != NULL)
                    printf("%s", str);
                fclose(fp);;//affiche le tableau des scores
                printf("\n\n");
                break;

                case 4:
                    printf("identification(in progress)");//permet au joueur de s'identifier
                printf("\nEntrez un Nom:\n");
                scanf("%s", &playername);
                break;

                case 5:
                    printf("fermer (in progress)");//ferme le programme
                printf("Voulez-vous quitter?\n"
                       "oui =5 / non =0");
                emptyBuffer();
                scanf("&d", &end);

                break;

                default:

                    printf("Erreur! veuillez reessayer!\n");

                break;

            }

        }

    } while (end = 5);


}

